-- TABELAS:  pedido(X), estoque(X), capacidade_estoque(X), item_produto()

-- PEDIDO
DROP TABLE PEDIDO CASCADE CONSTRAINTS;

CREATE TABLE PEDIDO(
NUMERO              NUMBER,             
DATA                DATE                not null,
PRAZO_ENTREGA       DATE                not null,
RUA                 varchar2(80)        null,
NR                  NUMBER(4)           null,
BAIRRO              varchar2(50)        null,
COMPLEMENTO         varchar2(100)       null,
CIDADE              varchar2(80)        null,
UF                  varchar2(2)         null,
CEP                 varchar2(10)        null,
TOTAL_FATURA        NUMBER(8,2)         null,
CODIGO_CLI          NUMBER              not null,
MATRICULA_VEN       NUMBER              not null
);
DESC PEDIDO;

ALTER TABLE PEDIDO
ADD CONSTRAINT PK_PEDIDO PRIMARY KEY (NUMERO);

ALTER TABLE PEDIDO
ADD CONSTRAINT FK_PED_CLIENTE FOREIGN KEY (CODIGO_CLI) REFERENCES CLIENTE (CODIGO);

ALTER TABLE PEDIDO
ADD CONSTRAINT FK_PED_VENDEDOR FOREIGN KEY (MATRICULA_VEN) REFERENCES VENDEDOR (MATRICULA);


-- ESTOQUE
DROP TABLE ESTOQUE CASCADE CONSTRAINTS;

CREATE TABLE ESTOQUE (
DATA_ENTRADA        DATE,        
CODIGO_PRO          NUMBER      not null, 
CODIGO_PRA          NUMBER(3)   not null, 
QUANTIDADE          NUMBER(5)   not null, 
DATA_VALIDADE       DATE        null    
);
DESC ESTOQUE;

ALTER TABLE ESTOQUE
ADD CONSTRAINT PK_ESTOQUE PRIMARY KEY (DATA_ENTRADA, CODIGO_PRO, CODIGO_PRA);

ALTER TABLE ESTOQUE 
ADD CONSTRAINT FK_EST_PRODUTO FOREIGN KEY (CODIGO_PRO) REFERENCES PRODUTO (CODIGO);

ALTER TABLE ESTOQUE
ADD CONSTRAINT FK_EST_PRATELEIRA FOREIGN KEY (CODIGO_PRA) REFERENCES PRATELEIRA (CODIGO);


-- CAPACIDADE_ESTOQUE
DROP TABLE CAPACIDADE_ESTOQUE CASCADE CONSTRAINTS;

CREATE TABLE CAPACIDADE_ESTOQUE (
CODIGO_PRO      NUMBER,     
CODIGO_PRA      NUMBER(3)   not null,
QUANTIDADE      NUMBER(5)   not null
);
DESC CAPACIDADE_ESTOQUE;

ALTER TABLE CAPACIDADE_ESTOQUE
ADD CONSTRAINT PK_CAPACIDADE_ESTOQUE PRIMARY KEY (CODIGO_PRO, CODIGO_PRA);

ALTER TABLE CAPACIDADE_ESTOQUE
ADD CONSTRAINT FK_CAP_EST_PRODUTO FOREIGN KEY (CODIGO_PRO) REFERENCES PRODUTO (CODIGO);

ALTER TABLE CAPACIDADE_ESTOQUE
ADD CONSTRAINT FK_CAP_EST_PRATELEIRA FOREIGN KEY (CODIGO_PRA) REFERENCES PRATELEIRA (CODIGO);


-- ITEM PRODUTO
DROP TABLE ITEM_PRODUTO CASCADE CONSTRAINTS;

CREATE TABLE ITEM_PRODUTO (
CODIGO_PRO      NUMBER,          
NUMERO_PED      NUMBER(6)       not null,
QUANTIDADE      NUMBER(5)       not null,
PRECO_UNITARIO  NUMBER(5,2)     not null,
VALOR_ITEM      NUMBER(7,2)     null
);
DESC ITEM_PRODUTO;

ALTER TABLE ITEM_PRODUTO
ADD CONSTRAINT PK_ITEM_PRODUTO PRIMARY KEY (CODIGO_PRO, NUMERO_PED);

ALTER TABLE ITEM_PRODUTO
ADD CONSTRAINT FK_ITEM_PRODUTO FOREIGN KEY (CODIGO_PRO) REFERENCES PRODUTO (CODIGO);

ALTER TABLE ITEM_PRODUTO
ADD CONSTRAINT FK_ITEM_PEDIDO FOREIGN KEY (NUMERO_PED) REFERENCES PEDIDO (NUMERO);

SELECT * 
FROM USER_TABLES
WHERE TABLE_NAME IN ('PEDIDO','ESTOQUE', 'CAPACIDADE_ESTOQUE', 'ITEM_PRODUTO');

